setwd("~/Dropbox/buzzfeed_encrypted/stories/2018/2018-10-russian-troll-tweets")
# download Twitter IRA tweet data
download.file("https://storage.googleapis.com/twitter-election-integrity/hashed/ira/ira_tweets_csv_hashed.zip", destfile="ira_tweets.zip")
en_ira_tweets <- read_csv("data/ira_tweets_csv_hashed.csv") %>%
filter(tweet_language == "en") %>%
mutate(handle = tolower(user_screen_name))
library(readr)
library(dplyr)
library(utils)
# load, filter for English language tweets, create field for join to Clemson data
en_ira_tweets <- read_csv("data/ira_tweets_csv_hashed.csv") %>%
filter(tweet_language == "en") %>%
mutate(handle = tolower(user_screen_name))
clemson <- data_frame()
for (n in c(1:12)) {
tmp <- read_csv(paste0("https://raw.githubusercontent.com/fivethirtyeight/russian-troll-tweets/master/IRAhandle_tweets_",n,".csv"))
clemson <- bind_rows(clemson,tmp)
}
clemson <- data_frame()
for (n in c(1:12)) {
tmp <- read_csv(paste0("https://raw.githubusercontent.com/fivethirtyeight/russian-troll-tweets/master/IRAhandle_tweets_",n,".csv"), col_types = ols(
.default = col_character(),
following = col_integer(),
followers = col_integer(),
updates = col_integer(),
retweet = col_integer(),
new_june_2018 = col_integer()
))
clemson <- bind_rows(clemson,tmp)
}
clemson <- data_frame()
for (n in c(1:13)) {
tmp <- read_csv(paste0("https://raw.githubusercontent.com/fivethirtyeight/russian-troll-tweets/master/IRAhandle_tweets_",n,".csv"), col_types = cols(
.default = col_character(),
following = col_integer(),
followers = col_integer(),
updates = col_integer(),
retweet = col_integer(),
new_june_2018 = col_integer()
))
clemson <- bind_rows(clemson,tmp)
}
glimpse(clemson)
clemson <- clemson %>%
mutate(handle = tolower(author))
clemson <- clemson %>%
mutate(handle = tolower(author)) %>%
rename(tweetid = tweet_id)
test <- left_join(en_ira_tweets, by = "tweetid") %>%
rename(account_category1 = account_category)
test <- left_join(en_ira_tweets, clemson, by = "tweetid") %>%
rename(account_category1 = account_category)
glimpse(en_ira_tweets)
en_ira_tweets <- read_csv("data/ira_tweets_csv_hashed.csv", col_types = cols(tweetid=col_character())) %>%
filter(tweet_language == "en") %>%
mutate(handle = tolower(user_screen_name))
test <- left_join(en_ira_tweets, clemson, by = "tweetid") %>%
rename(account_category1 = account_category)
clemson_tweetids <- clemson %>%
select(tweet_id,account_category) %>%
rename(tweetid = tweet_id) %>%
unique()
clemson_handles <- clemson  %>%
select(author,account_category) %>%
mutate(handle=tolower(author)) %>%
select(handle,account_category) %>%
unique()
clemson_tweetids <- clemson %>%
select(tweet_id,account_category) %>%
# rename(tweetid = tweet_id) %>%
unique()
clemson_tweetids <- clemson %>%
select(tweetid,account_category) %>%
# rename(tweetid = tweet_id) %>%
unique()
test <- left_join(en_ira_tweets, clemson_tweetids, by = "tweetid") %>%
rename(account_category1 = account_category)
test <- test %>%
mutate(account_category = case_when(is.na(account_category1) ~ account_category2,
!is.na(account_category1) ~ account_category1))
test <- left_join(test, clemson_handles, by = "handle") %>%
rename(account_category2 = account_category)
test <- test %>%
mutate(account_category = case_when(is.na(account_category1) ~ account_category2,
!is.na(account_category1) ~ account_category1))
View(test)
test <- left_join(en_ira_tweets, clemson_tweetids, by = "tweetid") %>%
rename(account_category1 = account_category) %>%
arrange(user_id) %>%
group_by(user_id) %>%
fill(account_category1)
glimpse(test)
test <- left_join(en_ira_tweets, clemson_tweetids, by = "tweetid") %>%
rename(account_category1 = account_category) %>%
arrange(userid) %>%
group_by(userid) %>%
fill(account_category1)
library(tidyr)
test <- left_join(en_ira_tweets, clemson_tweetids, by = "tweetid") %>%
rename(account_category1 = account_category) %>%
arrange(userid) %>%
group_by(userid) %>%
fill(account_category1)
View(test)
test2 <- test %>%
group_by(userid,account_category1) %>%
count()
View(test2)
test2 <- test %>%
group_by(userid,handle,account_category1) %>%
count()
View(test2)
test <- left_join(en_ira_tweets, clemson_tweetids, by = "tweetid") %>%
rename(account_category) %>%
arrange(userid) %>%
group_by(userid) %>%
zoo:na.locf(account_category)
test <- left_join(en_ira_tweets, clemson_tweetids, by = "tweetid") %>%
rename(account_category) %>%
arrange(userid) %>%
group_by(userid) %>%
zoo::na.locf(account_category)
test$account_category1 <- zoo::na.locf(test$account_category)
test <- left_join(en_ira_tweets, clemson_tweetids, by = "tweetid") %>%
rename(account_category) %>%
arrange(userid) %>%
group_by(userid)
test <- left_join(test, clemson_handles, by = "handle") %>%
rename(account_category2 = account_category)
test <- test %>%
mutate(account_category = case_when(is.na(account_category1) ~ account_category2,
!is.na(account_category1) ~ account_category1)) %>%
select(-account_category1, account_category2)
test <- left_join(en_ira_tweets, clemson_tweetids, by = "tweetid") %>%
rename(account_category) %>%
arrange(userid)
test <- left_join(test, clemson_handles, by = "handle") %>%
rename(account_category2 = account_category)
test <- test %>%
mutate(account_category = case_when(is.na(account_category1) ~ account_category2,
!is.na(account_category1) ~ account_category1)) %>%
select(-account_category1, account_category2)
test <- left_join(en_ira_tweets, clemson_tweetids, by = "tweetid") %>%
rename(account_category) %>%
arrange(userid)
test <- left_join(test, clemson_handles, by = "handle") %>%
rename(account_category2 = account_category)
test <- test %>%
mutate(account_category = case_when(is.na(account_category1) ~ account_category2,
!is.na(account_category1) ~ account_category1)) %>%
select(-account_category1, -account_category2)
test <- left_join(en_ira_tweets, clemson_tweetids, by = "tweetid") %>%
rename(account_category) %>%
arrange(userid)
test <- left_join(en_ira_tweets, clemson_tweetids, by = "tweetid") %>%
rename(account_category1 = account_category) %>%
arrange(userid)
test <- left_join(test, clemson_handles, by = "handle") %>%
rename(account_category2 = account_category)
test <- test %>%
mutate(account_category = case_when(is.na(account_category1) ~ account_category2,
!is.na(account_category1) ~ account_category1)) %>%
select(-account_category1, -account_category2)
View(test)
test <- test %>%
group_by(userid) %>%
mutate(account_category = zoo::na.locf(account_category))
test <- test %>%
group_by(userid) %>%
fill(account_category)
View(test)
test <- test %>%
group_by(userid) %>%
fill(account_category, direction = "down",
account_category, direction = "up")
test <- test %>%
group_by(userid) %>%
fill(account_category, .direction = "down",
account_category, .direction = "up")
test <- test %>%
group_by(userid) %>%
fill(account_category, .direction = "down") %>%
fill(account_category, .direction = "up")
View(test)
write_csv(test, "data/en_ira_tweets.csv", na="")
en_ira_tweets <- en_ira_tweets %>%
select(-handle)
# write data to file
write_csv(test, "data/en_ira_tweets.csv", na="")
test <- en_ira_tweets %>%
group_by(userid) %>%
fill(account_category, .direction = "down") %>%
fill(account_category, .direction = "up") %>%
mutate(account_category = case_when(is.na(account_category) ~ "Unknown",
!is.na(account_category) ~ account_category)) %>%
ungroup()
View(en_ira_tweets)
test <- test %>%
group_by(userid) %>%
fill(account_category, .direction = "down") %>%
fill(account_category, .direction = "up") %>%
mutate(account_category = case_when(is.na(account_category) ~ "Unknown",
!is.na(account_category) ~ account_category)) %>%
ungroup()
View(test)
# write data to file
write_csv(test, "data/en_ira_tweets.csv", na="")
